ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã§ã¯ã€[hakoniwa-px4sim](https://github.com/toppers/hakoniwa-px4sim) ã‚’ç™ºå±•ã•ã›ã€æ‹¡å¼µæ€§ã¨æ±ç”¨æ€§ã‚’é«˜ã‚ãŸãƒ‰ãƒ­ãƒ¼ãƒ³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã®ã‚³ã‚¢æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚PX4ã‚„Ardupilotã€ãƒ­ãƒœãƒƒãƒˆã‚·ã‚¹ãƒ†ãƒ (ROS)ã€ã•ã‚‰ã«ã¯ã‚¹ãƒãƒ›ã€XRã€Webã¨ã®é€£æºã‚‚è¦–é‡ã«å…¥ã‚ŒãŸæŸ”è»Ÿãªè¨­è¨ˆãŒç‰¹å¾´ã§ã™ã€‚


# ã‚³ãƒ³ã‚»ãƒ—ãƒˆ

ã€Œã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸–ç•Œã‚’é£›ã³å‡ºã™ï¼ã€ã‚’ãƒ¢ãƒƒãƒˆãƒ¼ã«ã€ä»¥ä¸‹ã®3ã¤ã‚’æŸ±ã¨ã—ã¦ã„ã¾ã™ï¼š

- **ã‚·ãƒ³ãƒ—ãƒ«ã•**: èª°ã§ã‚‚ç°¡å˜ã«ä½¿ãˆã‚‹ãƒ‰ãƒ­ãƒ¼ãƒ³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã€‚  
- **å¤šæ§˜æ€§**: ã‚²ãƒ¼ãƒ ã€æ•™è‚²ã€ç ”ç©¶ã€ãƒ“ã‚¸ãƒã‚¹ãªã©ã€å¹…åºƒã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«å¯¾å¿œã€‚  
- **æ¥ç¶šæ€§**: PX4/Ardupilotã€Unityã€ROSã€ã‚¹ãƒãƒ›ã€XRã€Webã¨ã®ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹ãªé€£æºã€‚

---

## ã€Œã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¸–ç•Œã‚’é£›ã³å‡ºã™ï¼ã€ã¨ã¯ï¼Ÿ

ä»®æƒ³ç©ºé–“ã®ä¸­ã«é–‰ã˜ãšã€**ç¾å®Ÿä¸–ç•Œã®èª²é¡Œè§£æ±ºã‚„ä¾¡å€¤å‰µé€ **ã‚’ç›®æŒ‡ã—ãŸã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆã‚’æ„å‘³ã—ã¾ã™ï¼š

### **1. ç¾å®Ÿä¸–ç•Œã¨ã®æ¥ç¶š**
- **PX4/Ardupilot** ã‚„ **ROS** ã¨é€£æºã—ã€å®Ÿæ©Ÿã•ãªãŒã‚‰ã®åˆ¶å¾¡ã‚’å®Ÿç¾ã€‚  
- **ç‰©æµè©¦é¨“ã‚„å±•ç¤ºç”¨é€”**ã§ã®æ´»ç”¨ã«å¯¾å¿œã€‚  
- ä»®æƒ³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®çµæœã‚’ã€ã™ãã«å®Ÿæ©Ÿãƒ†ã‚¹ãƒˆã‚„é‹ç”¨ã«åæ˜ å¯èƒ½ã€‚  

### **2. å¤šæ§˜ãªãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œ**
- **ã‚¹ãƒãƒ›ã€XRã€Webã€Unity** ãªã©ã€ã•ã¾ã–ã¾ãªãƒ‡ãƒã‚¤ã‚¹ã‚„ç’°å¢ƒã§å‹•ä½œã€‚  
- ã‚²ãƒ¼ãƒ ã‚„ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ†ã‚¤ãƒ³ãƒ¡ãƒ³ãƒˆã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨ã—ã¦ã‚‚å±•é–‹å¯èƒ½ã€‚  

### **3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å‰µé€ æ€§ã‚’æ‹¡å¤§**
- æ•™è‚²å‘ã‘ã«ã€å­¦ç”Ÿã‚„å­¦ç¿’è€…ãŒç°¡å˜ã«ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã‚„åˆ¶å¾¡å·¥å­¦ã‚’ä½“é¨“ã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã‚’æä¾›ã€‚  
- éå°‚é–€å®¶ã§ã‚‚æ°—è»½ã«åˆ©ç”¨ã§ãã‚‹è¨­è¨ˆã§ã€ã‚²ãƒ¼ãƒ ã‚„å±•ç¤ºä¼šã§ã®ä½“é¨“æä¾›ã«ã‚‚æœ€é©ã€‚

---


# ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

- ã‚²ãƒ¼ãƒ : ãƒ‰ãƒ­ãƒ¼ãƒ³æ“ç¸¦ã‚’æ‰‹è»½ã«æ¥½ã—ã‚€ã€‚
- ã‚¨ãƒ³ã‚¿ãƒ¡: å±•ç¤ºç”¨é€”ï¼ˆä¾‹: ä¸‡åšã§ã®ãƒ‡ãƒ¢ï¼‰ã€‚
- è¨“ç·´: ãƒ—ãƒ­æ“ç¸¦è€…å‘ã‘ã®ãƒªã‚¢ãƒ«ãªå‹•ä½œå†ç¾ã€‚
- æ•™è‚²: åˆ¶å¾¡å·¥å­¦ã‚„ãƒ¢ãƒ‡ãƒªãƒ³ã‚°å­¦ç¿’ã€‚
- ç ”ç©¶: ç’°å¢ƒã‚„æ©Ÿä½“ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€‚
- ç‰©æµ: å®Ÿè¨¼å®Ÿé¨“å ´ã¨ã—ã¦æ´»ç”¨ã€‚


# ç‰¹å¾´

1. C/C++ ãƒ™ãƒ¼ã‚¹ï¼š ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ãƒ»ã‚³ã‚¢æ©Ÿèƒ½ã‚’Cãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦æä¾›ã—ã€ä»–ã®è¨€èªã§ã®æ‹¡å¼µã‚’å®¹æ˜“åŒ–ã€‚
2. [TOPPERS ãƒ©ã‚¤ã‚»ãƒ³ã‚¹](https://www.toppers.jp/license.html)ï¼šã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ã§ã€å•†ç”¨åˆ©ç”¨ã‚‚å¯èƒ½ã€‚
3. è¤‡æ•°ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œ: Windows, Mac, Linux, WSL2 ãªã©ä¸»è¦OSã‚’ã‚µãƒãƒ¼ãƒˆã€‚
4. ç®±åº­ãƒ¢ãƒ¼ãƒ‰ã¨éç®±åº­ãƒ¢ãƒ¼ãƒ‰ã®ã‚µãƒãƒ¼ãƒˆ
   - ç®±åº­ã‚ã‚Šï¼šãƒ­ãƒœãƒƒãƒˆã‚·ã‚¹ãƒ†ãƒ (ROS)ã‚„ã€ã‚¹ãƒãƒ›ã‚„XRã€Webã¨é€£æºã—ãŸã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒå¯èƒ½ã€‚
   - ç®±åº­ãªã—ï¼šãƒ‰ãƒ­ãƒ¼ãƒ³ã®ç‰©ç†ãƒ¢ãƒ‡ãƒ«ã‚„åˆ¶å¾¡ãƒ¢ãƒ‡ãƒ«ã‚’ç‹¬ç«‹ã—ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå¯èƒ½ã€‚PX4/Ardupilotã¨ã®é€£æºã‚‚å¯èƒ½ã€‚

# ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒª

## å¤–éƒ¨

- [glm](https://github.com/g-truc/glm.git) : æ•°å­¦ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€‚
- [mavlink_c_library_v2](https://github.com/mavlink/c_library_v2.git) : MAVLinké€šä¿¡ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€‚
- [nlohmann/json](https://github.com/nlohmann/json.git) : JSONæ“ä½œãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€‚

## å†…éƒ¨

- [hakoniwa-core-cpp-client](https://github.com/toppers/hakoniwa-core-cpp-client.git) : ç®±åº­ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã®çµ±åˆã€‚
- [hakoniwa-ros2pdu](https://github.com/toppers/hakoniwa-ros2pdu.git) : ç®±åº­PDUã¨ã®çµ±åˆã€‚

# ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

![image](https://github.com/user-attachments/assets/e36e559e-a424-4a4d-a66a-a498378c375e)

- comm (é€šä¿¡ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«) : TCP/UDP ã®é€šä¿¡ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹
  - ICommServer API: ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã®é€šä¿¡æ©Ÿèƒ½ã‚’æä¾›
    - TCP/UDPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«å¯¾å¿œã—ãŸé€šä¿¡ã‚µãƒ¼ãƒãƒ¼ã®ç”Ÿæˆ
    - ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ã®æ¥ç¶šå¾…ã¡å—ã‘ã¨é€šä¿¡ç®¡ç†
    - ä½¿ç”¨å‰ã«ã¯å¿…ãšcomm_init()ã®å‘¼ã³å‡ºã—ãŒå¿…è¦
  - ICommClient API: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®é€šä¿¡æ©Ÿèƒ½ã‚’æä¾›
    - TCP/UDPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã«å¯¾å¿œã—ãŸé€šä¿¡ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ç”Ÿæˆ
    - é€ä¿¡å…ƒãƒ»é€ä¿¡å…ˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®æŒ‡å®šã«ã‚ˆã‚‹é€šä¿¡ç¢ºç«‹
    - ä½¿ç”¨å‰ã«ã¯å¿…ãšcomm_init()ã®å‘¼ã³å‡ºã—ãŒå¿…è¦
  - ICommIO API: é€šä¿¡ãƒ‡ãƒ¼ã‚¿ã®é€å—ä¿¡æ©Ÿèƒ½ã‚’æä¾›
    - ãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡ãƒ»å—ä¿¡æ“ä½œã®æŠ½è±¡åŒ–ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
    - TCPã§ã¯åˆ°é”ä¿è¨¼ã¨ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ã‚’æä¾›
    - UDPã§ã¯é«˜é€Ÿãªé€šä¿¡ã‚’å®Ÿç¾ï¼ˆåˆ°é”ä¿è¨¼ãªã—ï¼‰
  - è©³ç´°ãª API ä»•æ§˜ã¯[ã‚µãƒ¼ãƒãƒ¼](docs/api/comm/server/api_comm_server.md)ã€[ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ](docs/api/comm/client/api_comm_client.md)ã€[IO](docs/api/comm/io/api_comm_io.md)ã‚’å‚ç…§
- mavlink (MAVLINKé€šä¿¡) : MAVLINKé€šä¿¡ã®ã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹
- physics (ç‰©ç†ãƒ¢ãƒ‡ãƒ«) :  [æ©Ÿä½“ã®ç‰©ç†ãƒ¢ãƒ‡ãƒ«](docs/api/physics/README-ja.md)
- controller (åˆ¶å¾¡ãƒ¢ãƒ‡ãƒ«) : æ©Ÿä½“ã®åˆ¶å¾¡ãƒ¢ãƒ‡ãƒ«
- aircraft (æ©Ÿä½“ãƒ¢ãƒ‡ãƒ«) : ç‰©ç†ãƒ¢ãƒ‡ãƒ«ãŠã‚ˆã³ã‚»ãƒ³ã‚µ/ã‚¢ã‚¯ãƒãƒ¥ã‚¨ãƒ¼ã‚¿ã‚’çµ±åˆã—ãŸæ©Ÿä½“ãƒ¢ãƒ‡ãƒ«
- service (ã‚µãƒ¼ãƒ“ã‚¹)
  - aircaft_service (æ©Ÿä½“ã‚µãƒ¼ãƒ“ã‚¹) : ç®±åº­ãªã—ã§ã€PX4ã¨é€£æºã™ã‚‹ãŸã‚ã®ã‚µãƒ¼ãƒ“ã‚¹
  - drone_service (ãƒ‰ãƒ­ãƒ¼ãƒ³ã‚µãƒ¼ãƒ“ã‚¹) : ç®±åº­ãªã—ã§ã€åˆ¶å¾¡/ç‰©ç†ãƒ¢ãƒ‡ãƒ«ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ã‚µãƒ¼ãƒ“ã‚¹
- hakoniwa (ç®±åº­) :  serviceã‚’ç®±åº­ã«çµ±åˆã—ãŸã‚µãƒ¼ãƒ“ã‚¹
- logger (ãƒ­ã‚°) :  æ©Ÿä½“ã®ãƒ­ã‚°
- config (ã‚³ãƒ³ãƒ•ã‚£ã‚°) :  ãƒ‰ãƒ­ãƒ¼ãƒ³ã®ã‚³ãƒ³ãƒ•ã‚£ã‚°

# å‹•ä½œç’°å¢ƒ

* ã‚µãƒãƒ¼ãƒˆOS
  * Armç³»Mac
  * Windows 11
  * Windows WSL2
  * Ubuntu 22.0.4

* ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«
  * cmake
  * googletest

* å¿…è¦ãªãƒ„ãƒ¼ãƒ«é¡
  * pyenv
    * python: version 3.12.0
      * 3.13ä»¥é™ã§ã¯å‹•ãã¾ã›ã‚“ã€‚
      * MacOSã®å ´åˆã€homebrewã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚‚ã®ã§ã¯å‹•ãã¾ã›ã‚“ã€‚

# âœ… ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿æº–å‚™ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ã“ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã« **ç®±åº­ã‚ã‚Šï¼ãªã—** ã®2ãƒ¢ãƒ¼ãƒ‰ã§åˆ©ç”¨å¯èƒ½ã§ã™ã€‚  
ãã‚Œãã‚Œã«å¿…è¦ãªç’°å¢ƒã‚„ãƒ„ãƒ¼ãƒ«ãŒç•°ãªã‚‹ãŸã‚ã€äº‹å‰ã«ä»¥ä¸‹ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ã”ç¢ºèªãã ã•ã„ã€‚

| é …ç›® | èª¬æ˜ | ç®±åº­ã‚ã‚Šç‰ˆ | ç®±åº­ãªã—ç‰ˆ |
|------|------|------------|------------|
| OSç’°å¢ƒ | Windows / macOS (Armå¯¾å¿œ) / Linux / WSL2 | âœ… | âœ… |
| Pythonç’°å¢ƒ | `Python 3.12.0` ã‚’ä½¿ç”¨ | âœ… | âœ… |
| Unityã‚¨ãƒ‡ã‚£ã‚¿ | [hakoniwa-unity-drone](https://github.com/hakoniwalab/hakoniwa-unity-drone) ã®å®Ÿè¡Œã«å¿…è¦ | âœ… | âŒ |
| Unityãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæº–å‚™ | `Avatar` ã‚·ãƒ¼ãƒ³ã‚’é–‹ãã€`START`ãƒœã‚¿ãƒ³ã§ã‚·ãƒŸãƒ¥é–‹å§‹ | âœ… | âŒ |
| hakoniwa-core-cpp-client | ç®±åº­ã‚³ã‚¢ã¨ã®æ¥ç¶šã«å¿…é ˆ | âœ… | âŒ |
| QGroundControl | PX4é€£æºæ™‚ã®æ“ä½œã«ä½¿ç”¨ | âœ… | âœ… |
| MissionPlanner | Ardupiloté€£æºæ™‚ã®æ“ä½œã«ä½¿ç”¨ | âœ… | âœ… |
| Gameã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ© | ãƒ©ã‚¸ã‚³ãƒ³æ“ä½œã«ä½¿ç”¨ (ä»»æ„) | âœ… | âŒ |
| Droneç”¨Python API | ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³è¨˜è¿°ã«ä½¿ç”¨å¯èƒ½ | âœ… | âŒ |
| Webé€£æº (ä»»æ„) | [hakoniwa-webserver](https://github.com/toppers/hakoniwa-webserver) ãªã© | âœ… | âŒ |
| ROS2é€£æº (ä»»æ„) | [hakoniwa-ros2pdu](https://github.com/toppers/hakoniwa-ros2pdu) ãªã© | âœ… | âŒ |

ğŸ“Œ **å‚™è€ƒ**
- Pythonã¯ **3.12.0** å›ºå®šï¼ˆãã‚Œä»¥å¤–ã¯éå¯¾å¿œï¼‰
- Macç’°å¢ƒã§ã¯ `homebrew` çµŒç”±ã®Pythonã§ã¯å‹•ä½œã—ã¾ã›ã‚“
- Unityã‚¨ãƒ‡ã‚£ã‚¿ã¯ã€Unity6.0ä»¥é™ãŒå¿…è¦ã§ã™
- Gameã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã‚’ä½¿ã†å ´åˆã¯ `rc/rc_config/` ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„

---


# ç®±åº­ãªã—ã§åˆ©ç”¨ã™ã‚‹ã‚±ãƒ¼ã‚¹

ç®±åº­ãªã—ã§åˆ©ç”¨ã™ã‚‹å ´åˆã€ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã®ç‰©ç†ãƒ¢ãƒ‡ãƒ«ã¨åˆ¶å¾¡ãƒ¢ãƒ‡ãƒ«ã‚’ç‹¬ç«‹ã—ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

è£œè¶³ï¼šç®±åº­ã¨ã®é€£æºãŒã‚ã‚Šã¾ã›ã‚“ã®ã§ã€Unityã§ã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚ºã¯ã§ãã¾ã›ã‚“ã€‚

æä¾›ãƒã‚¤ãƒŠãƒªã¨ã—ã¦ã¯ä»¥ä¸‹ã®ã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚

1. PX4 é€£æºã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª(<oså>-aircraft_service_px4)
2. Ardupilot é€£æºã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª(<oså>-aircraft_service_ardupilot)
3. ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã®CUIã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª(<oså>-drone_servce_rc)
4. ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³Pro Cãƒ©ã‚¤ãƒ–ãƒ©ãƒª(hako_service_c)

å…¨ã¦ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚ãƒªãƒªãƒ¼ã‚¹ãƒšãƒ¼ã‚¸ã«ã‚ã‚‹ãƒã‚¤ãƒŠãƒªã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚

osåã¯ã€ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

- mac
- win
- linux

## PX4 é€£æºã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®åˆ©ç”¨æ–¹æ³•

PX4 é€£æºã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’ä½¿ã†ã¨ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã®ç‰©ç†ãƒ¢ãƒ‡ãƒ«ã¨PX4ã‚’é€£æºã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

å®Ÿè¡Œæ–¹æ³•ï¼š
```bash
<oså>-aircraft_service_px4 <IPã‚¢ãƒ‰ãƒ¬ã‚¹> 4560 ./config/drone/px4 
```

ã“ã®éš›ã€PX4ã‚’èµ·å‹•ã™ã‚‹ã“ã¨ã§ã€PX4ã¨é€£æºã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

å‚è€ƒï¼šhttps://github.com/toppers/hakoniwa-px4sim?tab=readme-ov-file#terminal-a

ã‚ã‚ã›ã¦ã€QGCã¨é€£æºã™ã‚‹ã“ã¨ã§ã€é éš”æ“ä½œãŒå¯èƒ½ã§ã™ã€‚


## Ardupilot é€£æºã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®åˆ©ç”¨æ–¹æ³•

Ardupilot é€£æºã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’ä½¿ã†ã¨ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã®ç‰©ç†ãƒ¢ãƒ‡ãƒ«ã¨Ardupilotã‚’é€£æºã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

å®Ÿè¡Œæ–¹æ³•ï¼š
```bash
<oså>-aircraft_service_ardupilot <ãƒ›ã‚¹ãƒˆPCã®IPã‚¢ãƒ‰ãƒ¬ã‚¹> 9002 9003 ./config/drone/ardupilot 
```

ã“ã®éš›ã€Ardupilotã‚’èµ·å‹•ã™ã‚‹ã“ã¨ã§ã€Ardupilotã¨é€£æºã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

```bash
./Tools/autotest/sim_vehicle.py -v ArduCopter -f airsim-copter -A "--sim-port-in 9003 --sim-port-out 9002"  --sim-address=<ãƒ›ã‚¹ãƒˆPCã®IPã‚¢ãƒ‰ãƒ¬ã‚¹>  --out=udp:<Mission Plannerã®IPã‚¢ãƒ‰ãƒ¬ã‚¹>:14550
```

å‚è€ƒï¼šhttps://github.com/ArduPilot/ardupilot

ã“ã®éš›ã€Mission Plannerã¨é€£æºã™ã‚‹ã“ã¨ã§ã€é éš”æ“ä½œãŒå¯èƒ½ã§ã™ã€‚

## ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã®CUIã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®åˆ©ç”¨æ–¹æ³•

ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã®ç‰©ç†ãƒ¢ãƒ‡ãƒ«ã¨åˆ¶å¾¡ãƒ¢ãƒ‡ãƒ«ã‚’é€£æºã•ã›ã¦ã€CUIã§æ“ä½œã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

```bash
service/drone_service_rc 1 config/drone/rc
```

```
 ----- USAGE -----
 ----- STICK -----
|  LEFT  | RIGHT  |
|   w    |   i    |
| a   d  | j   l  |
|   s    |   k    |
 ---- BUTTON ----
 x : radio control button
 p : get position
 r : get attitude
 t : get simtime usec
 f : flip
 b : get battery status
```


å®Ÿè¡Œä¾‹ï¼šèµ·å‹•ç›´å¾Œã®ãƒ­ã‚°
```bash
BatteryModelCsvFilePath: ./tmp_battery_model.csv
BatteryModelCsvFilePath does not exist.
Angle rate control is disabled
Angle rate control is disabled
flip_target_time_sec: 0.4
flip_constant_time_sec: 0.1
target_angular_rate_rad_sec: 25.1327
target_angular_rate_delta: 0.167552
target_angular_inc_time_sec: 0.15
target_angular_dec_time_sec: 0.25
INFO: mixer is enabled
timestep_usec: 1000
DroneService::startService: 1000
> Start service
```

ã“ã®çŠ¶æ…‹ã§ã€ã‚¢ãƒ¼ãƒ ã™ã‚‹ã«ã¯ã€`x`ã‚’å…¥åŠ›ã—ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ã‚’æŠ¼ä¸‹ã—ã¾ã™ã€‚

ãã®å¾Œã€`w`ã‚’å…¥åŠ›ã—ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ã‚’æŠ¼ä¸‹ã™ã‚‹ã“ã¨ã§ã€ä¸Šæ˜‡ã—ã¾ã™ã€‚

å®Ÿè¡Œä¾‹ï¼šã‚¢ãƒ¼ãƒ ã—ã¦ä¸Šæ˜‡
```bash
> Start service
x
w
position x=0.0 y=-0.0 z=0.1
position x=0.0 y=-0.0 z=0.2
position x=0.0 y=-0.0 z=0.3
position x=0.0 y=-0.0 z=0.4
position x=0.0 y=-0.0 z=0.5
position x=0.0 y=-0.0 z=0.6
position x=0.0 y=-0.0 z=0.7
position x=0.0 y=-0.0 z=0.8
position x=0.0 y=-0.0 z=0.9
position x=0.0 y=-0.0 z=1.0
position x=0.0 y=-0.0 z=1.1
```

å®Ÿè¡Œä¾‹ï¼šå‰é€²
```bash
i
position x=0.1 y=0.0 z=1.2
position x=0.2 y=0.0 z=1.3
position x=0.3 y=0.0 z=1.3
position x=0.4 y=0.0 z=1.3
position x=0.5 y=0.0 z=1.3
position x=0.6 y=0.0 z=1.3
```

## ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³Pro Cãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®åˆ©ç”¨æ–¹æ³•

ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã¯ã€Cãƒ©ã‚¤ãƒ–ãƒ©ãƒª(hako_service_c)ã¨ã—ã¦ãƒã‚¤ãƒŠãƒªå…¬é–‹ã—ã¦ã„ã¾ã™ã€‚

ä»¥ä¸‹ã®ãƒ˜ãƒƒãƒ€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã§ã€ãƒ“ãƒ«ãƒ‰ï¼†ãƒªãƒ³ã‚¯å¯èƒ½ã§ã™ã€‚

- include/service/service.h

ãªãŠã€C APIãƒ˜ãƒƒãƒ€ã¯ä»¥ä¸‹ã§ã™ã€‚

- include/service/drone/drone_service_rc_api.h

# ç®±åº­ã‚ã‚Šã§åˆ©ç”¨ã™ã‚‹ã‚±ãƒ¼ã‚¹

ç®±åº­ã‚ã‚Šã§åˆ©ç”¨ã™ã‚‹å ´åˆã€ç®±åº­ãªã—ã®æ©Ÿèƒ½ã«åŠ ãˆã¦ã€ä»¥ä¸‹ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

1. Unityé€£æº: [hakoniwa-unity-drone](https://github.com/hakoniwalab/hakoniwa-unity-drone)ã‚’åˆ©ç”¨
2. ãƒ‡ã‚¸ã‚¿ãƒ«ãƒ„ã‚¤ãƒ³é€£æº: [Zenoh/ROS2ç®±åº­ãƒ–ãƒªãƒƒã‚¸](https://github.com/toppers/hakoniwa-bridge)ã‚’åˆ©ç”¨
3. Mission Planneré€£æº: [MAVLinkç®±åº­ãƒ–ãƒªãƒƒã‚¸](mavlink/bridge/README.md)ã‚’åˆ©ç”¨
4. ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã®ARå…±æœ‰ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: [ç®±åº­Webã‚µãƒ¼ãƒãƒ¼](https://github.com/toppers/hakoniwa-webserver)ãŠã‚ˆã³[ç®±åº­ARãƒ–ãƒªãƒƒã‚¸](https://github.com/toppers/hakoniwa-ar-bridge)ã‚’åˆ©ç”¨

ç®±åº­ã‚ã‚Šç‰ˆã®æä¾›ãƒã‚¤ãƒŠãƒªã¨ã—ã¦ã¯ä»¥ä¸‹ã®ã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚

1. PX4 é€£æºã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª(<oså>-main_hako_aircraft_service_px4)
2. Ardupilot é€£æºã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª(<oså>-main_hako_aircraft_service_ardupilot)
3. ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª(<oså>-main_hako_drone_servce)

å…¨ã¦ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚ãƒªãƒªãƒ¼ã‚¹ãƒšãƒ¼ã‚¸ã«ã‚ã‚‹ãƒã‚¤ãƒŠãƒªã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚

osåã¯ã€ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

- mac
- win
- linux

## ç®±åº­ã‚³ã‚¢æ©Ÿèƒ½ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ç®±åº­ã‚ã‚Šç‰ˆã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã€äº‹å‰ã«ã€[hakoniwa-core-cpp-client](https://github.com/toppers/hakoniwa-core-cpp-client)ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚

Windowsã®å ´åˆã¯ã€WSL2ã§ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```bash
dd if=/dev/zero of=/mnt/z/mmap/mmap-0x100.bin bs=1M count=5
```

ç†ç”±ï¼šramdiskä¸Šã® mmap ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚µã‚¤ã‚ºãŒè¶³ã‚Šãªã„ãŸã‚ã€‚(5MBä»¥ä¸Šå¿…è¦)

## Unityã‚¨ãƒ‡ã‚£ã‚¿ã®æº–å‚™

ç®±åº­ã‚ã‚Šç‰ˆã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã€äº‹å‰ã«ã€[hakoniwa-unity-drone](https://github.com/hakoniwalab/hakoniwa-unity-drone)ã®simulatinãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’Unityã‚¨ãƒ‡ã‚£ã‚¿ã§é–‹ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

Unityã‚¨ãƒ‡ã‚£ã‚¿èµ·å‹•å¾Œã€Avatarã‚·ãƒ¼ãƒ³ã‚’é–‹ã„ã¦ãã ã•ã„ã€‚

![image](docs/images/unity-editor.png)

ã“ã®ã‚·ãƒ¼ãƒ³ã§ã¯ã€ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã®ä½ç½®ã¨å§¿å‹¢æƒ…å ±ãŠã‚ˆã³ãƒ­ãƒ¼ã‚¿ãƒ¼ã®PWMãƒ‡ãƒ¥ãƒ¼ãƒ†ã‚£å€¤ã‚’å—ä¿¡ã—ã€ãƒ‰ãƒ­ãƒ¼ãƒ³ã®å‹•ãã‚’ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ©ã‚¤ã‚ºã—ã¾ã™ã€‚

ç®±åº­ã‚ã‚Šç‰ˆã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã¨é€£æºã™ã‚‹ã“ã¨ã§ã€Unityã‚¨ãƒ‡ã‚£ã‚¿ä¸Šã§ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã®å‹•ãã‚’ç¢ºèªã§ãã¾ã™ã€‚

ã¾ãŸã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã™ã‚‹ã«ã¯ã€ä¸‹å›³ã«ã‚ã‚‹ START ãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã—ã¦ãã ã•ã„ã€‚

![image](docs/images/unity-sim.png)

## PX4 é€£æºã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®åˆ©ç”¨æ–¹æ³•

PX4 é€£æºã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’ä½¿ã†ã¨ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã®ç‰©ç†ãƒ¢ãƒ‡ãƒ«ã¨PX4ã‚’é€£æºã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

å®Ÿè¡Œæ–¹æ³•ï¼š
```bash
<oså>-main_hako_aircraft_service_px4 <IPã‚¢ãƒ‰ãƒ¬ã‚¹> 4560 ./config/drone/px4 <path/to/hakoniwa-unity-drone>/simulation/avatar-drone.json
```

* è£œè¶³ï¼š
  * Windowsã®å ´åˆã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã€Power Shellã§ã€ipconfigã‚’å®Ÿè¡Œã—ãŸã¨ãã®WSLã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚
  * ã‚¤ãƒ¼ã‚µãƒãƒƒãƒˆ ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ vEthernet (WSL (Hyper-V firewall)):


ã“ã®éš›ã€PX4ã‚’èµ·å‹•ã™ã‚‹ã“ã¨ã§ã€PX4ã¨é€£æºã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

å‚è€ƒï¼šhttps://github.com/toppers/hakoniwa-px4sim?tab=readme-ov-file#terminal-a

ã‚ã‚ã›ã¦ã€QGCã¨é€£æºã™ã‚‹ã“ã¨ã§ã€é éš”æ“ä½œãŒå¯èƒ½ã§ã™ã€‚


ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ‰‹é †ï¼š

1. Unityã‚¨ãƒ‡ã‚£ã‚¿ã§Avatarã‚·ãƒ¼ãƒ³ã‚’é–‹ãã€‚
2. PX4 é€£æºã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã™ã‚‹ã€‚
3. PX4 ã‚’èµ·å‹•ã™ã‚‹ã€‚
4. Unityã‚¨ãƒ‡ã‚£ã‚¿ã§ã€STARTãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã™ã‚‹ã€‚
5. QGCã‚’èµ·å‹•ã—ã€PX4ã¨æ¥ç¶šã—ã€é éš”æ“ä½œã‚’è¡Œã†ã€‚


## Ardupilot é€£æºã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®åˆ©ç”¨æ–¹æ³•

Ardupilot é€£æºã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’ä½¿ã†ã¨ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã®ç‰©ç†ãƒ¢ãƒ‡ãƒ«ã¨Ardupilotã‚’é€£æºã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

å®Ÿè¡Œæ–¹æ³•ï¼š
```bash
<oså>-main_hako_aircraft_service_ardupilot <ãƒ›ã‚¹ãƒˆPCã®IPã‚¢ãƒ‰ãƒ¬ã‚¹> 9002 9003 ./config/drone/ardupilot <path/to/hakoniwa-unity-drone>/simulation/avatar-drone.json
```

ã“ã®éš›ã€Ardupilotã‚’èµ·å‹•ã™ã‚‹ã“ã¨ã§ã€Ardupilotã¨é€£æºã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

```bash
./Tools/autotest/sim_vehicle.py -v ArduCopter -f airsim-copter -A "--sim-port-in 9003 --sim-port-out 9002"  --sim-address=<ãƒ›ã‚¹ãƒˆPCã®IPã‚¢ãƒ‰ãƒ¬ã‚¹>  --out=udp:<Mission Plannerã®IPã‚¢ãƒ‰ãƒ¬ã‚¹>:14550
```

å‚è€ƒï¼šhttps://github.com/ArduPilot/ardupilot

ã“ã®éš›ã€Mission Plannerã¨é€£æºã™ã‚‹ã“ã¨ã§ã€é éš”æ“ä½œãŒå¯èƒ½ã§ã™ã€‚

ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ‰‹é †ï¼š

1. Unityã‚¨ãƒ‡ã‚£ã‚¿ã§Avatarã‚·ãƒ¼ãƒ³ã‚’é–‹ãã€‚
2. Ardupilot é€£æºã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã™ã‚‹ã€‚
3. Ardupilot ã‚’èµ·å‹•ã™ã‚‹ã€‚
4. Unityã‚¨ãƒ‡ã‚£ã‚¿ã§ã€STARTãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã™ã‚‹ã€‚
5. Mission Planner ã‚’èµ·å‹•ã—ã€Ardupilot ã¨æ¥ç¶šã—ã€é éš”æ“ä½œã‚’è¡Œã†ã€‚


## ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã®åˆ©ç”¨æ–¹æ³•

ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’ä½¿ã†ã¨ã€ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã®ç‰©ç†ãƒ¢ãƒ‡ãƒ«ã¨åˆ¶å¾¡ãƒ¢ãƒ‡ãƒ«ã‚’é€£æºã•ã›ã¦ã€CUIã§æ“ä½œã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã¯ã€ä»¥ä¸‹ã®ï¼’ç¨®é¡ã‚ã‚Šã¾ã™ã€‚

1. ãƒ©ã‚¸ã‚³ãƒ³æ“ä½œã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª
2. ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³æ“ä½œã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª

### ãƒ©ã‚¸ã‚³ãƒ³æ“ä½œã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª

ãŠä½¿ã„ã®ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã§ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã‚’æ“ä½œã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

å®Ÿè¡Œæ–¹æ³•ï¼š
```bash
<oså>-main_hako_drone_servce  ./config/drone/rc <path/to/hakoniwa-unity-drone>/simulation/avatar-drone.json
```

ã“ã®éš›ã€ãƒ©ã‚¸ã‚³ãƒ³æ“ä½œç”¨ã®Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã‚’æ“ä½œã§ãã¾ã™ã€‚

```bash
python rc/rc-custom.py <path/to/hakoniwa-unity-drone>/simulation/avatar-drone.json rc/rc_config/ps4-control.json
```

æœ€å¾Œã®å¼•æ•°(ps4-control.json)ã¯ã€ãŠä½¿ã„ã®ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã«åˆã‚ã›ã¦å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ‰‹é †ï¼š

1. Unityã‚¨ãƒ‡ã‚£ã‚¿ã§Avatarã‚·ãƒ¼ãƒ³ã‚’é–‹ãã€‚
2. ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã™ã‚‹ã€‚
3. Unityã‚¨ãƒ‡ã‚£ã‚¿ã§ã€STARTãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã™ã‚‹ã€‚
4. ãƒ©ã‚¸ã‚³ãƒ³æ“ä½œç”¨ã®Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èµ·å‹•ã™ã‚‹ã€‚
5. ã‚²ãƒ¼ãƒ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ã§ã€ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã‚’æ“ä½œã™ã‚‹ã€‚


### ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³æ“ä½œã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª

ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã® [Python API](drone_api/libs/README.md) ã‚’åˆ©ç”¨ã—ã¦ã€ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³æ“ä½œã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªï¼š[sample.py](drone_api/rc/sample.py)

å®Ÿè¡Œæ–¹æ³•ï¼š
```bash
<oså>-main_hako_drone_servce  ./config/drone/api <path/to/hakoniwa-unity-drone>/simulation/avatar-drone.json
```

ã“ã®éš›ã€ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³æ“ä½œç”¨ã®Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã‚’æ“ä½œã§ãã¾ã™ã€‚

```bash
python rc/sample.py <path/to/hakoniwa-unity-drone>/simulation/avatar-drone.json
```

ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ‰‹é †ï¼š

1. Unityã‚¨ãƒ‡ã‚£ã‚¿ã§Avatarã‚·ãƒ¼ãƒ³ã‚’é–‹ãã€‚
2. ç®±åº­ãƒ‰ãƒ­ãƒ¼ãƒ³ã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã™ã‚‹ã€‚
3. Unityã‚¨ãƒ‡ã‚£ã‚¿ã§ã€STARTãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã™ã‚‹ã€‚
4. ãƒ•ãƒ©ã‚¤ãƒˆãƒ—ãƒ©ãƒ³æ“ä½œç”¨ã®Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èµ·å‹•ã™ã‚‹ã€‚

# TIPS
## Windows ã§ ç®±åº­ã‚ã‚Šç‰ˆPX4/Ardupiloté€£æºã™ã‚‹å ´åˆã«ã¤ã„ã¦

Windowsã§ PX4/Ardupiloté€£æºã™ã‚‹å ´åˆã€WSLã¨ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ—ãƒªé–“ã§é«˜é »åº¦ãªé€šä¿¡ãŒç™ºç”Ÿã—ã¾ã™(3msæ¯ã«é€šä¿¡)ã€‚

![image](docs/images/win-px4-arch.png)

ãã®ãŸã‚ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é€Ÿåº¦ãŒéå¸¸ã«é…ããªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼ˆä½“æ„Ÿã§ï¼“âˆ’ï¼”å€ç¨‹åº¦é…ããªã‚‹ï¼‰ã€‚

ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é€Ÿåº¦ã‚’æ”¹å–„ã™ã‚‹æ–¹æ³•ã¨ã—ã¦ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ§‹æˆã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€æ”¹å–„ã§ãã¾ã™ã€‚

![image](docs/images/wsl-px4-arch.png)


ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œæ‰‹é †ï¼š

1. [Unityã‚¨ãƒ‡ã‚£ã‚¿ã§WebAvatarã‚·ãƒ¼ãƒ³ã‚’é–‹ãã€‚](#Unityã‚¨ãƒ‡ã‚£ã‚¿ã§WebAvatarã‚·ãƒ¼ãƒ³ã‚’é–‹ã)
2. [WSLã§ã€åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#wslã§åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
3. [WSLã§ã€PX4 ã‚’èµ·å‹•ã™ã‚‹ã€‚](#wslã§px4-ã‚’èµ·å‹•ã™ã‚‹)
4. [WSLã§ã€PX4 é€£æºã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã™ã‚‹ã€‚](#wslã§px4-é€£æºã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã™ã‚‹)
5. [WSLã§ã€ç®±åº­Webã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹ã€‚](#wslã§ç®±åº­webã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹)
6. [WSLã§ã€ç®±åº­ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã™ã‚‹ã€‚](#wslã§ç®±åº­ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã™ã‚‹)
7. Unityã‚¨ãƒ‡ã‚£ã‚¿ã®WebAvatarã‚·ãƒ¼ãƒ³ã®Playãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã€‚
8. QGCã‚’èµ·å‹•ã—ã€PX4ã¨æ¥ç¶šã—ã€é éš”æ“ä½œã‚’è¡Œã†ã€‚

### Unityã‚¨ãƒ‡ã‚£ã‚¿ã§WebAvatarã‚·ãƒ¼ãƒ³ã‚’é–‹ãã€‚

ãƒ’ã‚¨ãƒ©ãƒ«ã‚­ãƒ¼ãƒ“ãƒ¥ãƒ¼ã®`HakoniwaWeb` ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿ãƒ“ãƒ¥ãƒ¼ã®`Server Uri` ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’WSLã®IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ã—ã¦ãã ã•ã„ã€‚

![image](https://github.com/user-attachments/assets/b7c14be1-0342-40e5-be07-77a0574adea2)


### WSLã§ã€åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

#### ç®±åº­ã‚³ãƒãƒ³ãƒ‰ã®ãƒ‘ã‚¹ã‚’é€šã™ã€‚

ç’°å¢ƒå¤‰æ•° `PATH` ã«ã€ç®±åº­ã‚³ãƒãƒ³ãƒ‰ã®ãƒ‘ã‚¹ã‚’é€šã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

è¨­å®šä¾‹ï¼š
```bash
export PATH=$PATH:/usr/local/bin/hakoniwa
```

å¿…è¦ã«å¿œã˜ã¦ã€`~/.bashrc` ã‚„ `~/.zshrc` ã«è¿½è¨˜ã—ã¦ãã ã•ã„ã€‚

```bash
echo 'export PATH=$PATH:/usr/local/bin/hakoniwa' >> ~/.bashrc
source ~/.bashrc
```

#### WSLã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ç§»å‹•ã—ã€ç©ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆã™ã‚‹

ã“ã“ã§ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’ `project`ã¨ã—ã¦ã„ã¾ã™ãŒã€ä»»æ„ã®è‹±å­—ã§æ§‹ã„ã¾ã›ã‚“ã€‚

```bash
cd ~
mkdir project
cd project
```

ãªãŠã€å¾Œè¿°ã™ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã¯ã€ã™ã¹ã¦ project ç›´ä¸‹ã«ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦ãã ã•ã„ã€‚

#### hakoniwa-drone-coreã®ã‚¯ãƒ­ãƒ¼ãƒ³

äº‹å‰ã«ã€hakoniwa-drone-core ã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦ãã ã•ã„ã€‚

```bash
git clone --recursive https://github.com/toppers/hakoniwa-drone-core.git
```

ã¾ãŸã€æœ€æ–°ã®ãƒªãƒªãƒ¼ã‚¹ã‹ã‚‰ lnx.zip ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—hakoniwa-drone-core ç›´ä¸‹ã«è§£å‡ã—ã¦ãã ã•ã„ã€‚

#### hakoniwa-unity-droneã®ã‚¯ãƒ­ãƒ¼ãƒ³

äº‹å‰ã«ã€hakoniwa-unity-drone ã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦ãã ã•ã„ã€‚

```bash
git clone --recursive https://github.com/hakoniwalab/hakoniwa-unity-drone.git
```

### WSLã§ã€PX4 ã‚’èµ·å‹•ã™ã‚‹ã€‚

```bash
cd hakoniwa-px4sim/px4/PX4-Autopilot
```

```bash
bash ../sim/simstart.bash
```

æˆåŠŸã™ã‚‹ã¨ã“ã†ãªã‚Šã¾ã™ã€‚

```
tmori@WinHako:~/project/hakoniwa-px4sim/px4/PX4-Autopilot$ bash ../sim/simstart.bash
Linux WinHako 5.15.167.4-microsoft-standard-WSL2 #1 SMP Tue Nov 5 00:21:55 UTC 2024 x86_64 x86_64 x86_64 GNU/Linux
INFO: SINGLE INSTANCE MODE
[0/1] launching px4 none_iris (SYS_AUTOSTART=10016)

______  __   __    ___
| ___ \ \ \ / /   /   |
| |_/ /  \ V /   / /| |
|  __/   /   \  / /_| |
| |     / /^\ \ \___  |
\_|     \/   \/     |_/

px4 starting.

INFO  [px4] startup script: /bin/sh etc/init.d-posix/rcS 0
env SYS_AUTOSTART: 10016
INFO  [param] selected parameter default file parameters.bson
INFO  [param] importing from 'parameters.bson'
INFO  [parameters] BSON document size 411 bytes, decoded 411 bytes (INT32:13, FLOAT:7)
INFO  [param] selected parameter backup file parameters_backup.bson
INFO  [dataman] data manager file './dataman' size is 7868392 bytes
INFO  [init] PX4_SIM_HOSTNAME: 127.0.0.1
INFO  [simulator_mavlink] using TCP on remote host 127.0.0.1 port 4560
WARN  [simulator_mavlink] Please ensure port 4560 is not blocked by a firewall.
INFO  [simulator_mavlink] Resolved host '127.0.0.1' to address: 127.0.0.1
INFO  [simulator_mavlink] Waiting for simulator to accept connection on TCP port 4560
```

### WSLã§ã€PX4 é€£æºã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã™ã‚‹ã€‚

```bash
lnx/linux-main_hako_aircraft_service_px4 127.0.0.1 4560 ./config/drone/px4 <path/to/hakoniwa-unity-drone>/simulation/avatar-drone.json
```

æˆåŠŸã™ã‚‹ã¨ã“ã†ãªã‚Šã¾ã™ã€‚

```
tmori@WinHako:~/project/hakoniwa-drone-core$ ./lnx/linux-main_hako_aircraft_service_px4 127.0.01 4560 config/drone/px4 ../hakoniwa-unity-drone/simulation/webavatar.json
BatteryModelCsvFilePath: ./tmp_battery_model.csv
BatteryModelCsvFilePath does not exist.
INFO: aircraft_index=0
MavLinkService initialized
asset_name: drone
conductor start
conductor start done
simulator register
asset_name = drone
config_path = ../hakoniwa-unity-drone/simulation/webavatar.json
INFO: hako_conductor thread start
Robot: Drone, PduWriter: Drone_motor
channel_id: 0 pdu_size: 112
INFO: Drone create_lchannel: logical_id=0 real_id=0 size=112
Robot: Drone, PduWriter: Drone_pos
channel_id: 1 pdu_size: 72
INFO: Drone create_lchannel: logical_id=1 real_id=1 size=72
Robot: Drone, PduWriter: Drone_disturb
channel_id: 3 pdu_size: 56
INFO: Drone create_lchannel: logical_id=3 real_id=2 size=56
Robot: Drone, PduWriter: Drone_battery
channel_id: 4 pdu_size: 56
INFO: Drone create_lchannel: logical_id=4 real_id=3 size=56
Robot: Drone, PduWriter: Drone_velocity
channel_id: 5 pdu_size: 72
INFO: Drone create_lchannel: logical_id=5 real_id=4 size=72
Robot: Drone, PduWriter: Drone_drone_cmd_takeoff
channel_id: 6 pdu_size: 88
INFO: Drone create_lchannel: logical_id=6 real_id=5 size=88
Robot: Drone, PduWriter: Drone_drone_cmd_move
channel_id: 7 pdu_size: 104
INFO: Drone create_lchannel: logical_id=7 real_id=6 size=104
Robot: Drone, PduWriter: Drone_drone_cmd_land
channel_id: 8 pdu_size: 88
INFO: Drone create_lchannel: logical_id=8 real_id=7 size=88
Robot: Drone, PduWriter: Drone_hako_cmd_game
channel_id: 9 pdu_size: 160
INFO: Drone create_lchannel: logical_id=9 real_id=8 size=160
Robot: Drone, PduWriter: Drone_hako_cmd_camera
channel_id: 10 pdu_size: 44
INFO: Drone create_lchannel: logical_id=10 real_id=9 size=44
Robot: Drone, PduWriter: Drone_hako_cmd_camera_move
channel_id: 11 pdu_size: 64
INFO: Drone create_lchannel: logical_id=11 real_id=10 size=64
Robot: Drone, PduWriter: Drone_hako_cmd_magnet_holder
channel_id: 14 pdu_size: 40
INFO: Drone create_lchannel: logical_id=14 real_id=11 size=40
Robot: Drone, PduWriter: Drone_impulse
channel_id: 2 pdu_size: 216
INFO: Drone create_lchannel: logical_id=2 real_id=12 size=216
Robot: Drone, PduWriter: Drone_hako_camera_data
channel_id: 12 pdu_size: 1002992
INFO: Drone create_lchannel: logical_id=12 real_id=13 size=1002992
Robot: Drone, PduWriter: Drone_hako_cmd_camera_info
channel_id: 13 pdu_size: 56
INFO: Drone create_lchannel: logical_id=13 real_id=14 size=56
Robot: Drone, PduWriter: Drone_hako_status_magnet_holder
channel_id: 15 pdu_size: 32
INFO: Drone create_lchannel: logical_id=15 real_id=15 size=32
Robot: Drone, PduWriter: Drone_lidar_points
channel_id: 16 pdu_size: 177424
INFO: Drone create_lchannel: logical_id=16 real_id=16 size=177424
Robot: Drone, PduWriter: Drone_lidar_pos
channel_id: 17 pdu_size: 72
INFO: Drone create_lchannel: logical_id=17 real_id=17 size=72
INFO: asset(drone) is registered.
HakoniwaPduAccessor::init()
HakoniwaPduAccessor::create_map()
reader: robot_name = Drone, channel_id = 2, pdu_size = 216
reader: robot_name = Drone, channel_id = 12, pdu_size = 1002992
reader: robot_name = Drone, channel_id = 13, pdu_size = 56
reader: robot_name = Drone, channel_id = 15, pdu_size = 32
reader: robot_name = Drone, channel_id = 16, pdu_size = 177424
reader: robot_name = Drone, channel_id = 17, pdu_size = 72
reader: robot_name = Drone, channel_id = 0, pdu_size = 112
reader: robot_name = Drone, channel_id = 1, pdu_size = 72
reader: robot_name = Drone, channel_id = 3, pdu_size = 56
reader: robot_name = Drone, channel_id = 4, pdu_size = 56
reader: robot_name = Drone, channel_id = 5, pdu_size = 72
reader: robot_name = Drone, channel_id = 6, pdu_size = 88
reader: robot_name = Drone, channel_id = 7, pdu_size = 104
reader: robot_name = Drone, channel_id = 8, pdu_size = 88
reader: robot_name = Drone, channel_id = 9, pdu_size = 160
reader: robot_name = Drone, channel_id = 10, pdu_size = 44
reader: robot_name = Drone, channel_id = 11, pdu_size = 64
reader: robot_name = Drone, channel_id = 14, pdu_size = 40
writer: robot_name = Drone, channel_id = 0, pdu_size = 112
writer: robot_name = Drone, channel_id = 1, pdu_size = 72
writer: robot_name = Drone, channel_id = 3, pdu_size = 56
writer: robot_name = Drone, channel_id = 4, pdu_size = 56
writer: robot_name = Drone, channel_id = 5, pdu_size = 72
writer: robot_name = Drone, channel_id = 6, pdu_size = 88
writer: robot_name = Drone, channel_id = 7, pdu_size = 104
writer: robot_name = Drone, channel_id = 8, pdu_size = 88
writer: robot_name = Drone, channel_id = 9, pdu_size = 160
writer: robot_name = Drone, channel_id = 10, pdu_size = 44
writer: robot_name = Drone, channel_id = 11, pdu_size = 64
writer: robot_name = Drone, channel_id = 14, pdu_size = 40
writer: robot_name = Drone, channel_id = 2, pdu_size = 216
writer: robot_name = Drone, channel_id = 12, pdu_size = 1002992
writer: robot_name = Drone, channel_id = 13, pdu_size = 56
writer: robot_name = Drone, channel_id = 15, pdu_size = 32
writer: robot_name = Drone, channel_id = 16, pdu_size = 177424
writer: robot_name = Drone, channel_id = 17, pdu_size = 72
simulator register done
HakoniwaDroneService::registerService() done
INFO: lockStep=1
INFO: deltaTimeUsec=3000
INFO: AircraftService startService wait for connection : 0
INFO: AircraftService startService is returned : 0
INFO: COMMAND_LONG ack sended: ret = 1
INFO: AircraftService started
WAIT START
```

### WSLã§ã€ç®±åº­ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã™ã‚‹ã€‚

```bash
hako-cmd start
```

æˆåŠŸã™ã‚‹ã¨ã€PX4ã®ãƒ­ã‚°ãŒä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```
:
INFO  [simulator_mavlink] Waiting for simulator to accept connection on TCP port 4560
INFO  [simulator_mavlink] Simulator connected on TCP port 4560.
ERROR [simulator_mavlink] poll timeout 0, 111
ERROR [simulator_mavlink] poll timeout 0, 111
INFO  [lockstep_scheduler] setting initial absolute time to 1747721032882577 us
WARN  [vehicle_angular_velocity] no gyro selected, using sensor_gyro_fifo:0 1310988
INFO  [commander] LED: open /dev/led0 failed (22)
WARN  [health_and_arming_checks] Preflight Fail: ekf2 missing data
INFO  [mavlink] mode: Normal, data rate: 4000000 B/s on udp port 18570 remote port 14550
INFO  [mavlink] mode: Onboard, data rate: 4000000 B/s on udp port 14580 remote port 14540
INFO  [mavlink] mode: Onboard, data rate: 4000 B/s on udp port 14280 remote port 14030
INFO  [mavlink] mode: Gimbal, data rate: 400000 B/s on udp port 13030 remote port 13280
INFO  [logger] logger started (mode=all)
INFO  [logger] Start file log (type: full)
INFO  [logger] [logger] ./log/2025-05-20/06_03_53.ulg
INFO  [logger] Opened full log file: ./log/2025-05-20/06_03_53.ulg
* MPC_XY_CRUISE: curr: 20.0000 -> new: 3.5000
INFO  [mavlink] MAVLink only on localhost (set param MAV_{i}_BROADCAST = 1 to enable network)
INFO  [mavlink] MAVLink only on localhost (set param MAV_{i}_BROADCAST = 1 to enable network)
INFO  [px4] Startup script returned successfully
pxh> INFO  [tone_alarm] home set
INFO  [mavlink] partner IP: 172.31.0.1
INFO  [commander] Ready for takeoff!
```

### WSLã§ã€ç®±åº­Webã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹ã€‚

```bash
cd hakoniwa-unity-drone/hakoniwa-webserver
```

```bash
python -m server.main --asset_name WebServer --config_path ../simulation/webavatar.json --delta_time_usec 20000
```

æˆåŠŸã™ã‚‹ã¨ã€ã“ã†ãªã‚Šã¾ã™ã€‚

```
(venv) tmori@WinHako:~/project/hakoniwa-unity-drone/hakoniwa-webserver$ python -m server.main --asset_name WebServer --config_path ../simulation/webavatar.json --delta_time_usec 20000
INFO: start http server
INFO: start websocket server
run webserver
set event loop on asyncio
Starting WebSocket server...
INFO: Success for external initialization.
append_list(pub_pdus) : Drone 2 impulse
pdu create: Drone 2 216
WebSocket server started on ws://0.0.0.0:8765
append_list(pub_pdus) : Drone 12 hako_camera_data
pdu create: Drone 12 1002992
append_list(pub_pdus) : Drone 13 hako_cmd_camera_info
pdu create: Drone 13 56
append_list(pub_pdus) : Drone 15 hako_status_magnet_holder
Starting HTTP server on port 8000...
pdu create: Drone 15 32
append_list(pub_pdus) : Drone 16 lidar_points
pdu create: Drone 16 177424
append_list(pub_pdus) : Drone 17 lidar_pos
pdu create: Drone 17 72
append_list(pub_pdus) : Drone 0 motor
======== Running on http://localhost:8080 ========
(Press CTRL+C to quit)
pdu create: Drone 0 112
append_list(pub_pdus) : Drone 1 pos
pdu create: Drone 1 72
append_list(pub_pdus) : Drone 3 disturb
pdu create: Drone 3 56
append_list(pub_pdus) : Drone 4 battery
pdu create: Drone 4 56
append_list(pub_pdus) : Drone 5 velocity
pdu create: Drone 5 72
append_list(pub_pdus) : Drone 6 drone_cmd_takeoff
pdu create: Drone 6 88
append_list(pub_pdus) : Drone 7 drone_cmd_move
pdu create: Drone 7 104
append_list(pub_pdus) : Drone 8 drone_cmd_land
pdu create: Drone 8 88
append_list(pub_pdus) : Drone 9 hako_cmd_game
pdu create: Drone 9 160
append_list(pub_pdus) : Drone 10 hako_cmd_camera
pdu create: Drone 10 44
append_list(pub_pdus) : Drone 11 hako_cmd_camera_move
pdu create: Drone 11 64
append_list(pub_pdus) : Drone 14 hako_cmd_magnet_holder
pdu create: Drone 14 40
append_list(sub_pdus) : Drone 0 motor
pdu create: Drone 0 112
append_list(sub_pdus) : Drone 1 pos
pdu create: Drone 1 72
append_list(sub_pdus) : Drone 3 disturb
pdu create: Drone 3 56
append_list(sub_pdus) : Drone 4 battery
pdu create: Drone 4 56
append_list(sub_pdus) : Drone 5 velocity
pdu create: Drone 5 72
append_list(sub_pdus) : Drone 6 drone_cmd_takeoff
pdu create: Drone 6 88
append_list(sub_pdus) : Drone 7 drone_cmd_move
pdu create: Drone 7 104
append_list(sub_pdus) : Drone 8 drone_cmd_land
pdu create: Drone 8 88
append_list(sub_pdus) : Drone 9 hako_cmd_game
pdu create: Drone 9 160
append_list(sub_pdus) : Drone 10 hako_cmd_camera
pdu create: Drone 10 44
append_list(sub_pdus) : Drone 11 hako_cmd_camera_move
pdu create: Drone 11 64
append_list(sub_pdus) : Drone 14 hako_cmd_magnet_holder
pdu create: Drone 14 40
append_list(sub_pdus) : Drone 2 impulse
pdu create: Drone 2 216
append_list(sub_pdus) : Drone 12 hako_camera_data
pdu create: Drone 12 1002992
append_list(sub_pdus) : Drone 13 hako_cmd_camera_info
pdu create: Drone 13 56
append_list(sub_pdus) : Drone 15 hako_status_magnet_holder
pdu create: Drone 15 32
append_list(sub_pdus) : Drone 16 lidar_points
pdu create: Drone 16 177424
append_list(sub_pdus) : Drone 17 lidar_pos
pdu create: Drone 17 72
LOADED: PDU DATA
WARNING: on_simulation_step_async() took longer than delta_time_usec: 21.79 ms
```

## WSL ã§ã€Ardupilot ã‚’èµ·å‹•ã™ã‚‹ã¨ Warning, time moved backwards. Restarting timer.ãŒå‡ºãŸæ™‚ã®å¯¾å‡¦æ–¹æ³•

ã“ã®è­¦å‘Šã¯ã€Ardupilot SITL ãŒã‚·ã‚¹ãƒ†ãƒ æ™‚åˆ»ã®é€†è¡Œã‚’æ¤œå‡ºã—ãŸéš›ã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™ã€‚

### å¯¾å‡¦æ–¹æ³•

WSL2ã®æ™‚åˆ»åŒæœŸã‚’æ‰‹å‹•ã§å®Ÿè¡Œ

```bash
sudo hwclock -s
```

chrony ã«ã‚ˆã‚‹æ™‚åˆ»åŒæœŸ

```bash
sudo apt update
sudo apt install chrony
sudo systemctl start chronyd
sudo systemctl enable chronyd
```

WSL2ã‚’å†èµ·å‹•ã™ã‚‹

